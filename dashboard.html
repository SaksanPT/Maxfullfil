<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Class A</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f8f9fa; }
        .dashboard-card { border: none; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); overflow: hidden; background: white; }
        .card-header { background: #d32f2f; color: white; padding: 15px 20px; }
        #loadingOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.9); z-index: 9999;
            display: flex; justify-content: center; align-items: center; flex-direction: column;
        }
    </style>
</head>
<body>

<div id="loadingOverlay">
    <div class="spinner-border text-danger" style="width: 3rem; height: 3rem;" role="status"></div>
    <div class="mt-3 fw-bold text-danger">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Dashboard...</div>
</div>

<div class="container py-4">
    <div class="mb-3">
        <a href="index.html" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-2"></i> ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
        </a>
    </div>

    <div class="dashboard-card card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h4 class="m-0"><i class="fas fa-exclamation-triangle me-2"></i>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö (Class A & J=0)</h4>
            <button onclick="loadDashboardData()" class="btn btn-light btn-sm fw-bold text-danger">
                <i class="fas fa-sync-alt"></i> ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            </button>
        </div>
        <div class="card-body">
            <div class="row mb-3">
                <div class="col-md-6"><input type="text" id="searchInput" class="form-control" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." onkeyup="filterTable()"></div>
                <div class="col-md-6 text-end align-self-center"><span id="lastUpdate" class="text-muted small">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏£‡∏≠‡πÇ‡∏´‡∏•‡∏î...</span></div>
            </div>

            <div class="table-responsive">
                <table class="table table-striped table-hover" id="dashTable">
                    <thead class="table-dark text-center" id="tableHead"></thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
            <div id="errorMsg" class="alert alert-danger text-center mt-3" style="display:none;"></div>
        </div>
    </div>
</div>

<script>
    // ‚ö†Ô∏è‚ö†Ô∏è ‡πÅ‡∏Å‡πâ URL ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏±‡∏ö index.html ‚ö†Ô∏è‚ö†Ô∏è
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbySWsqrPKZWK-SeETlS1FIHgMZofPkeEbmERh1MDjpCshhFbPIVQoPL4jWPwFHlsQzw/exec';

    let allData = [];
    window.onload = loadDashboardData;

    async function loadDashboardData() {
        document.getElementById('loadingOverlay').style.display = 'flex';
        document.getElementById('errorMsg').style.display = 'none';

        try {
            const response = await fetch(SCRIPT_URL + '?action=dashboard');
            const json = await response.json();
            document.getElementById('loadingOverlay').style.display = 'none';

            if (json.status !== 'success') throw new Error(json.message);
            const rawData = json.data;
            
            if (!rawData || rawData.length === 0) {
                document.getElementById('tableBody').innerHTML = '<tr><td colspan="100%" class="text-center py-5 text-muted">‚úÖ ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥</td></tr>';
                document.getElementById('lastUpdate').innerText = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
                return;
            }

            const headers = rawData[0]; const body = rawData.slice(1);
            allData = [headers, ...body];

            let headHTML = '<tr>'; headers.forEach(h => headHTML += `<th>${h}</th>`); headHTML += '</tr>';
            document.getElementById('tableHead').innerHTML = headHTML;

            renderTable(body);
            document.getElementById('lastUpdate').innerText = `‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${new Date().toLocaleTimeString('th-TH')} (${body.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)`;
        } catch (err) {
            document.getElementById('loadingOverlay').style.display = 'none';
            document.getElementById('errorMsg').innerText = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err.message;
            document.getElementById('errorMsg').style.display = 'block';
        }
    }

    function renderTable(rows) {
        const tbody = document.getElementById('tableBody');
        if (rows.length === 0) { tbody.innerHTML = '<tr><td colspan="100%" class="text-center text-muted">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>'; return; }

        let html = '';
        rows.forEach(row => {
            html += '<tr>';
            row.forEach((cell, index) => {
                let alignClass = '';
                // J ‡∏Ñ‡∏∑‡∏≠ Index 5 -> ‡∏™‡∏µ‡πÅ‡∏î‡∏á
                if (index === 5) alignClass = 'text-center fw-bold text-danger';
                // K ‡∏Ñ‡∏∑‡∏≠ Index 6 -> ‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á
                else if (index === 6) alignClass = 'text-center'; 
                html += `<td class="${alignClass}">${cell}</td>`;
            });
            html += '</tr>';
        });
        tbody.innerHTML = html;
    }

    function filterTable() {
        const input = document.getElementById('searchInput').value.toLowerCase();
        const body = allData.slice(1);
        const filtered = body.filter(row => row.some(cell => String(cell).toLowerCase().includes(input)));
        renderTable(filtered);
    }
</script>
</body>
</html>